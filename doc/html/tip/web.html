<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>

<meta http-equiv="Content-Type" content="text/html" charset="zh_TW.UTF-8">
<title>Web Tips</title>
<link rel="stylesheet" href="../defaults.css" type="text/css">
</head><body>

<!-- header -->
      <h1>Web Tips</h1>
      <a href="#HTML"><li class="title">HTML</li></a>
      <br /><a href="#CGI"><li class="title">CGI</li></a>
      <br /><a href="#CSS selector"><li class="title">CSS selector</li></a>
      <br /><a href="#XPath"><li class="title">XPath</li></a>
      <br /><a href="#reference"><li class="title">Reference</li></a>
      <div class="context">
      </div>
      <hr />

<!-- HTML -->
      <a name="HTML"></a><h2>HTML</h2>
      <h3>form</h3>
      <p class="h3"></p>
      <hr />

<!-- CGI -->
      <a name="CGI"></a><h2>CGI</h2>
      <h3>introduction</h3>
      <p class="h3">CGI的完整名字是<strong>C</strong>ommon <strong>G</strong>ateway <strong>I</strong>nterface. 它是一種標準介面程式, 能讓你的網頁跟 WWW server 溝通, 達到跟使用者互動的效果. 透過CGI, 可產生動態網頁, 秀出 server 上的最新資料. 當link到一個CGI物件時, 取回的文件並非是一份靜態資料, 而是藉由程式動態產生的HTML資料流. 傳回來的資料也許分分秒秒都在更改, 或者針對使用者的特殊查詢而有不同的反應. 例如股票市場行情等等.
      <br />CGI並非是什麼特定語言, 事實上只要是在 WWW Server 上的執行檔, 皆可當作CGI 程式. 所以用什麼語言來撰寫 CGI 程式都可.
      </p>
      <div class="commands">Linux:~ # <span class="cmds">cat</span> /cgi-bin/<span class="vars">hello.sh</span>
      <br />#!/bin/sh
      <br />
      <br />cat &lt;&lt; EOF
      <br />Content-type:text/html
      <br />
      <br />&lt;html&gt;
      <br />&lt;body&gt;
      <br />&lt;p&gt;Run SH CGI&lt;/p&gt;
      <br />&lt;/body&gt;
      <br />&lt;/html&gt;
      <br />EOF
      <br />
      <br />

      <br />Linux:~ # <span class="cmds">cat</span> /cgi-bin/<span class="vars">hello.pl</span>
      <br />#!/usr/bin/env perl
      <br />
      <br />print &lt;&lt;EOF
      <br />Content-type:text/html
      <br />
      <br />&lt;html&gt;
      <br />&lt;body&gt;
      <br />&lt;p&gt;Run Perl CGI&lt;/p&gt;
      <br />&lt;/body&gt;
      <br />&lt;/html&gt;
      <br />EOF
      <br />
      <br /> 

      <br />Linux:~ # <span class="cat">python</span> /cgi-bin/<span class="vars">hello.py</span>
      <br />#!/usr/bin/env python
      <br />
      <br />print '''Content-type:text/html
      <br />
      <br />&lt;html&gt;
      <br />&lt;body&gt;
      <br />&lt;p&gt;Run Python CGI&lt;/p&gt;
      <br />&lt;/body&gt;
      <br />&lt;/html&gt;'''
      </div>
      <br />

      <h3>HTTP request method: get &amp; post</h3>
      <p class="h3">CGI程式與一般的程式最大的差別在於資料擷取的不同, 網頁資料的擷取上主要有兩種, 分別是透過GET與POST. 這兩種可以透過表單函數<strong>&lt;form method=&quot;GET/POST&quot;&gt;</strong>設定.
      <br />GET: 在網址列後面輸入變數(例如 ?<span class="ftns">var1</span>=<span class="vars">val1</span>&amp;<span class="ftns">var2</span>=<span class="vars">val2</span>)即可觀察到變數 Query_String.
      <br />POST: 在CGI程式之中，會被當做是Standard_input也就是當成外在輸入.
      </p>
      <div class="commands">Linux:~ # <span class="cmds">cat</span> /cgi-bin/<span class="vars">get.sh</span>
      <span class="cmts"># <span class="cmds">curl</span> http://127.0.0.1/cgi-bin/get.sh<strong>?</strong>name_sh=<span class="vars">john</span><strong>&amp;</strong>age_sh=<span class="vars">10</span></span>
      <br />#!/bin/sh
      <br />
      <br />if [ x$REQUEST_METHOD == xGET ]
      <br />then
      <br />&nbsp;&nbsp;for data in `echo $QUERY_STRING | tr &quot;&amp;&quot; &quot;\n&quot;`; do
      <br />&nbsp;&nbsp;&nbsp;&nbsp;key=`echo $data | awk -F= '{print $1}'`  
      <br />&nbsp;&nbsp;&nbsp;&nbsp;val=`echo $data | awk -F= '{print $2}'`  
      <br />&nbsp;&nbsp;&nbsp;&nbsp;if [ $key == name_sh ]
      <br />&nbsp;&nbsp;&nbsp;&nbsp;then
      <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name_sh=$val
      <br />&nbsp;&nbsp;&nbsp;&nbsp;fi
      <br />&nbsp;&nbsp;&nbsp;&nbsp;if [ $key == age_sh ]
      <br />&nbsp;&nbsp;&nbsp;&nbsp;then
      <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;age_sh=$val
      <br />&nbsp;&nbsp;&nbsp;&nbsp;fi
      <br />&nbsp;&nbsp;done
      <br />fi
      <br />
      <br />echo &quot;Content-type:text/html&quot;
      <br />echo &quot;&quot;
      <br />echo &quot;Hello ${name_sh}.&quot;
      <br />echo &quot;&lt;br /&gt;You are ${age_sh} years old.&quot;
      <br />
      <br />

      <br />Linux:~ # <span class="cmds">car</span> /cgi-bin/<span class="vars">get.pl</span>
      <br />#!/usr/bin/env perl
      <br />
      <br />my ($data, @datas, @keys, %FORM);
      <br />if ($ENV{'REQUEST_METHOD'} == 'GET') { $data = $ENV{'QUERY_STRING'}; }
      <br />
      <br />@datas = split(/&amp;/, $data);
      <br />$i = 0;
      <br />foreach $d (@datas) {
      <br />&nbsp;&nbsp;@tmp = split(/=/, $d);
      <br />&nbsp;&nbsp;$keys[$i] = $tmp[0];
      <br />&nbsp;&nbsp;$FORM{$tmp[0]} = $tmp[1];
      <br />&nbsp;&nbsp;$i++;
      <br />}
      <br />
      <br />print &quot;Content-type:text/html\n\n&quot;;
      <br />print &quot;Hello &quot; . $FORM{'name_pl'} . &quot;.\n&quot;;
      <br />print &quot;&lt;br /&gt;You are &quot; . $FORM{'age_pl'} . &quot; years old.&quot;;
      <br />
      <br />

      <br />Linux:~ # <span class="cmds">cat</span> /cgi-bin/<span class="vars">get.py</span>
      <br />#!/usr/bin/env python
      <br />
      <br />import os
      <br />keyL = []
      <br />FORMH = {}
      <br />if os.getenv('REQUEST_METHOD') == 'GET':
      <br />&nbsp;&nbsp;&nbsp;&nbsp;data = os.getenv('QUERY_STRING')
      <br />&nbsp;&nbsp;&nbsp;&nbsp;datas = data.split('&amp;')
      <br />&nbsp;&nbsp;&nbsp;&nbsp;for d in datas:
      <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp = d.split('=')
      <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyL.append(tmp[0])
      <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORMH[tmp[0]] = tmp[1]
      <br />
      <br />print &quot;Content-type:text/html\n\n&quot;
      <br />print &quot;Hi &quot;, FORMH['name_py'], &quot;.\n&quot;
      <br />print &quot;&lt;br /&gt;You are &quot;, FORMH['age_py'], &quot; years old.\n&quot;
      <br />
      <br />

      <br />Linux:~ # <span class="cmds">cat</span> /cgi-bin/<span class="vars">post.sh</span>
      <span class="cmts"># <span class="cmds">curl</span> -X POST http://127.0.0.1/cgi-bin/post.sh --data &quot;NAME_SH=<span class="vars">john</span>&amp;AGE_SH=<span class="vars">18</span>&quot;</span>
      <br />#!/bin/sh
      <br />
      <br />if [ x$REQUEST_METHOD == xPOST ]; then
      <br />&nbsp;&nbsp;read datas
      <br />&nbsp;&nbsp;for data in `echo $datas | tr &quot;&amp;&quot; &quot;\n&quot;`
      <br />&nbsp;&nbsp;do
      <br />&nbsp;&nbsp;&nbsp;&nbsp;key=`echo $data | awk -F= '{print $1}'`  
      <br />&nbsp;&nbsp;&nbsp;&nbsp;val=`echo $data | awk -F= '{print $2}'`  
      <br />&nbsp;&nbsp;&nbsp;&nbsp;if [ $key == NAME_SH ]
      <br />&nbsp;&nbsp;&nbsp;&nbsp;then
      <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAME_SH=$val
      <br />&nbsp;&nbsp;&nbsp;&nbsp;fi
      <br />&nbsp;&nbsp;&nbsp;&nbsp;if [ $key == AGE_SH ]
      <br />&nbsp;&nbsp;&nbsp;&nbsp;then
      <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AGE_SH=$val
      <br />&nbsp;&nbsp;&nbsp;&nbsp;fi
      <br />&nbsp;&nbsp;done
      <br />fi
      <br />
      <br />echo &quot;Content-type:text/html&quot;
      <br />echo &quot;&quot;
      <br />echo &quot;Hello ${NAME_SH}.&quot;
      <br />echo &quot;&lt;br /&gt;You are ${AGE_SH} years old.&quot;
      <br />
      <br />

      <br />Linux:~ # <span class="cmds">cat</span> /cgi-bin/<span class="vars">post.pl</span>
      <br />#!/usr/bin/env perl
      <br />
      <br />my ($data, @datas, @keys, %FORM);
      <br />if ($ENV{'REQUEST_METHOD'} == 'POST') { read(STDIN, $data, $ENV{'CONTENT_LENGTH'}); }
      <br />
      <br />@datas = split(/&amp;/, $data);
      <br />$i = 0;
      <br />foreach $d (@datas) {
      <br />&nbsp;&nbsp;@tmp = split(/=/, $d);
      <br />&nbsp;&nbsp;$keys[$i] = $tmp[0];
      <br />&nbsp;&nbsp;$FORM{$tmp[0]} = $tmp[1];
      <br />&nbsp;&nbsp;$i++;
      <br />}
      <br />
      <br />print &quot;Content-type:text/html\n\n&quot;;
      <br />print &quot;Hello &quot; . $FORM{'NAME_PL'} . &quot;.\n&quot;;
      <br />print &quot;&lt;br /&gt;You are &quot; . $FORM{'AGE_PL'} . &quot; years old.&quot;;
      <br />
      <br />

      <br />Linux:~ $ <span class="cmds">cat</span> /cgi-bin/<span class="vars">post.py</span>
      <br />#!/usr/bin/env python
      <br />
      <br />import os
      <br />import sys
      <br />keyL = []
      <br />FORMH = {}
      <br />if os.getenv('REQUEST_METHOD') == 'POST':
      <br />&nbsp;&nbsp;&nbsp;&nbsp;data = sys.stdin.readline()
      <br />&nbsp;&nbsp;&nbsp;&nbsp;print data
      <br />&nbsp;&nbsp;&nbsp;&nbsp;datas = data.split('&amp;')
      <br />&nbsp;&nbsp;&nbsp;&nbsp;for d in datas:
      <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp = d.split('=')
      <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyL.append(tmp[0])
      <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORMH[tmp[0]] = tmp[1]
      <br />
      <br />print &quot;Content-type:text/html\n\n&quot;
      <br />print &quot;Hi &quot;, FORMH['NAME_PY'], &quot;.\n&quot;
      <br />print &quot;&lt;br /&gt;You are &quot;, FORMH['AGE_PY'], &quot; years old.\n&quot;

        
      </div>
      <br />

      <h3>cgi module for perl, python</h3>
      <div class="commands">Linux:~ # <span class="cmds">cat</span> /cgi-bin/<span class="vars">cgi_ex.pl</span>
      <br />#!/usr/bin/env perl
      <br />
      <br />use CGI qw/:standard/;
      <br />print header;
      <br />print start_html('Simple CGI Script');
      <br />print 'Hi ', param('name');
      <br />print end_html;
      <br />
      <br />

      <br />Linux:~ # <span class="cmds">cat</span> /cgi-bin/<span class="vars">cgi_ex.py</span>
      <br />#!/usr/bin/env python
      <br />
      <br />import cgi, cgitb
      <br />
      <br />cgitb.enable()
      <span class="cmts"># troubleshooting</span>
      <br />form = cgi.FieldStorage()
      <br />
      <br />print "Content-type: text/html"
      <br />print
      <br />
      <br />print &quot;&quot;&quot;
      <br />&lt;html&gt;
      <br />&lt;head&gt;&lt;title&gt;Sample CGI Script&lt;/title&gt;&lt;/head&gt;
      <br />&lt;body&gt;
      <br />&nbsp;&nbsp;&lt;h3&gt; Sample CGI Script &lt;/h3&gt;
      <br />&nbsp;&nbsp;&lt;p&gt;Hi, %s&lt;/p&gt;&lt;br&gt;
      <br />&lt;/body&gt;
      <br />&quot;&quot;&quot; %form.getvalue('name', 'user')
      <br />
      <br />cgi.test() # test cgi

      </div>

      <hr />

 
<!-- reference -->
    <h2>Reference</h2>
    <li class="reference">http://www.proftpd.org</li>
    <br /><li class="reference">http://vsftpd.beasts.org</li>
    <br /><li class="reference">http://linux.vbird.org</li>
    <hr />

<!-- changelog -->
    <h2>Changelog</h2>
</body>
</html>